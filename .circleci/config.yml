version: 2.1

orbs:
  recorb:
    executors:
      default:
        macos:  # indicate that we are using the macOS executor
          xcode: 11.3.1
    commands:
      start:
        steps:
          - run: 
              name: Start Quicktime Screencast
              command: |
                cat \<<EOF > ./start_recording.scpt
                tell application "System Events"
                   activate
                   set UI elements enabled to true
                end tell
                tell application "QuickTime Player"
                   activate
                   close every window saving no
                   new screen recording
                   document "Screen Recording" start
                end tell
                EOF
                osascript ./start_recording.scpt &

      stop:
        steps:
          - run:
              when: always 
              name: Stop Quicktime Screencast
              command: |
                cat \<<EOF > ./stop_recording.scpt    
                tell application "System Events"
                   activate
                   set UI elements enabled to true
                end tell
                tell application "QuickTime Player"
                  tell document "Screen Recording"
                    pause
                    set current_path to do shell script "pwd"
                    set file_path to "/tmp/testrecording.mov"
                    save in (file_path as POSIX file)
                    -- export in ("../testrecording.mov" as POSIX file) using settings preset "480p"
                    stop
                    return "Test recording saved to " & file_path
                    close
                  end tell
                end tell
                EOF
                osascript ./stop_recording.scpt
          - store_artifacts:
              path: /tmp/testrecording.mov
              destination: Screencast.mov
    jobs:
      wrap:
        parameters:
          steps:
            type: steps
            description: steps to be captured by recordin
        executor: default
        steps:
          - start
          - steps: <<parameters.steps>>
          - stop



workflows:
  build-deploy:
    jobs:
      - recorb/wrap:
          steps:
            - run: open -a safari https://edwardawebb.com